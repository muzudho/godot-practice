# 前の関連記事

📖　[【将棋】千日手は後手何勝分か（＾～＾）？](https://crieit.net/posts/35bb78372fdb17061111e859632f839f)  

# はじめに

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　スレッド違いということで　提出直後に廃案になった、  
**先手勝率が７０％になったゲームで　先手の有利さを解消する案**　の残骸を　置いておくぜ」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　お父んは　国語ができないからな」  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
「　この誰も読んでないブログを使って　Crieit のダラ管理人のサーバー代で　記事を保管しましょう」  

## 欠点と課題

* きふわらべ式は、（先手勝率が７０％に偏らないような、先手勝率が５０％前後の）弱い将棋エンジン同士の対局だと、後手を持った方が有利になってしまう欠点がある
* きふわらべ式は、（先手勝率が７０％になるような）強い将棋エンジンと、（先手勝率が５０％前後の）弱い将棋エンジンが、混合して対局できるルールである必要がある。特にスイス式に組み込めるようにすることが課題

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　だから　コンピューター将棋の大会に　きふわらべ式は要らない。  
メーリングリストにメール送ったら　その返信で取り下げになった」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　わらう」  

## きふわらべ式の概要

* **１局の勝利の期待値を 0.5 に調整する**

![202312__shogi__01-1924--KomiDashi.png](https://crieit.now.sh/upload_images/113ff0446f420ea8846acfec02f119af656df18f0d08f.png)  

```plaintext
先手勝率を x とする。
　　　　
先手が勝ったときの
　　　　先手の勝ち星は　ｙ、
　　　　後手の勝ち星は　１－ｙ
とする。
　　　　
後手が勝ったときの
　　　　先手の勝ち星は　０、
　　　　後手の勝ち星は　１
とする。
　　　　
　　　　 １
ｙ　＝　────　
　　　　２ｘ
```

### 計算例

```plaintext
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ０
先手勝率　５０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ５


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 １
先手勝率　６０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　６　　　　　　　　　　 ６


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ２
先手勝率　７０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　７　　　　　　　　　　 ７


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ３
先手勝率　８０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　８　　　　　　　　　　 ８


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ４
先手勝率　９０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　９　　　　　　　　　　 ９


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ５
先手勝率１００％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　 １０　　　　　　　　　 １０
```

* 先手と後手の有利さが　５０％ vs ５０％　の場合、先手が勝つと　先手の１勝ち点、後手の０勝ち点となり　従来通りとなる
* もし将棋が強解決して、先手勝率が１００％だった場合、先手が勝つと　先手０．５勝ち点、後手０．５勝ち点　となり、勝負無しと同じことになる

### 数式の説明

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　小学６年生で習う、 **反比例** で　できている。  
`x` は、 `x` が大きくなるほど大きくなる **比例** だが、  
`1/x` は、 `x` が大きくなるほど数字が小さくなる **反比例** だな」  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　まず、将棋が強解決して、先手勝率１００％　になったとき、先手に 0.5 点しか入らないように調整する。  
先手勝率１００％　というのは　実数で書くと `1.0` だな。  
0.5 というのは分数で書くと `1/2` だな」  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　次に、将棋が　先手も　後手も　勝率が　５０％、５０％　のケースを想定する。  
この場合、先手が勝ったら　１勝　が入って欲しい。  
１勝というのは　実数で書くと `1.0` だな。  
1.0 というのは分数で書くと `1/1` だな。  
じゃあ、 `1/2` を `1/1` に調整するには、分母に `0.5` を掛ければいいな。  
`1/(2 * 0.5)`」  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　じゃあ `0.5` を　試しに `x` に置き換えてみようぜ？  
`1/(2 * x)`」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　先手勝率　７０％　なら `1/(2 * 0.7)`　で　いけてるな」  

# 筆算でシミュレーションしてみよう

ベースケース（**従来の番勝負の例**）：  

* 先手、後手の勝率は　５０％　vs　５０％　だろうと想定されている
* 先後を互いに交代する
* ５番勝負は　先に３勝した方の勝ち
* ７番勝負は　先に４勝した方の勝ち

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　新しい方法が、従来の方法を兼ねてたら　嬉しいだろ。  
従来の方法が　ベースケース（基本的なケース）となるように定義してみよう。  
きふわらべ式が、先手勝率　５０％　のとき、ベースケースと同じになるか　筆算して確認してみよう」  

## 先手勝率５０％のケース（ベースケース）

### 例１：　先手番だけが勝つケース（最長のケース）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手勝　 5/5　　後手負　 0/5　　　※先手に 5/5 勝ち点、後手 0/5 勝ち点。 1.0点先取性なら１番で終わり。対局者Ａの１点勝ち
..................................
２　　後手負　 5/5　　先手勝　 5/5　　　※先手に 0/5 勝ち点加算、後手 5/5 勝ち点加算。
３　　先手勝　10/5　　後手負　 5/5　　　※2.0点先取性なら３番で終わり。対局者Ａの２点勝ち
..................................
４　　後手負　10/5　　先手勝　10/5
５　　先手勝　15/5　　後手負　10/5　　　※3.0点先取性なら５番で終わり。対局者Ａの３点勝ち
..................................
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　ベースケースと同じだな」  

### 例２：　後手番だけが勝つケース（最短のケース）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手負　 0/5　　後手勝　 5/5　　　※先手に 0/5 勝ち点、後手 5/5 勝ち点。1.0点先取性なら１番で終わり。対局者Ｂの１点勝ち
..................................
２　　後手勝　 5/5　　先手負　 5/5
３　　先手負　 5/5　　後手勝　10/5　　　※2.0点先取性なら３番で終わり。対局者Ｂの２点勝ち
..................................
４　　後手勝　10/5　　先手負　10/5
５　　先手負　10/5　　後手勝　15/5　　　※3.0点先取性なら５番で終わり。対局者Ｂの３点勝ち
..................................
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　ベースケースと同じだな」  

## 先手勝率６０％のケース

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　じゃあ　先手勝率６０％　の特殊なケースを　シミュレーションしてみようぜ？」  

### 例３：　先手番だけが勝つケース（最長のケース）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手勝　 5/6　　後手負　 1/6　　　※先手に 5/6 勝ち点、後手 1/6 勝ち点
２　　後手負　 6/6　　先手勝　 6/6
３　　先手勝　11/6　　後手負　 7/6　　　※1.0点先取性なら３番で終わり。対局者Ａの１点勝ち
..................................
４　　後手負　12/6　　先手勝　12/6
５　　先手勝　17/6　　後手負　13/6　　　※2.0点先取性なら５番で終わり。対局者Ａの２点勝ち
..................................
６　　後手負　18/6　　先手勝　18/6　　　※勝ち点が同じなので、もう１対局行う
７　　先手勝　23/6　　後手負　19/6　　　※3.0点先取性なら７番で終わり。対局者Ａの３点勝ち
..................................
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　ベースケースに比べて、番勝負が２番　伸びたな」  

### 例４：　後手番だけが勝つケース（最短のケース）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手負　 0/6　　後手勝　 6/6　　　※先手に 0/6 勝ち点、後手 6/6 勝ち点。1.0点先取性なら１番で終わり。対局者Ｂの１点勝ち
..................................
２　　後手勝　 6/6　　先手負　 6/6
３　　先手負　 6/6　　後手勝　12/6　　　※2.0点先取性なら３番で終わり。対局者Ｂの２点勝ち
..................................
４　　後手勝　12/6　　先手負　12/6
５　　先手負　12/6　　後手勝　18/6　　　※3.0点先取性なら５番で終わり。対局者Ｂの３点勝ち
..................................
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　後手番だけが勝つケースは、常にベースケースと同じになるな」  

### 例５：　対局者Ａが１つ後手勝ちするケース

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手勝　 5/6　　後手負　 1/6
２　　後手勝　11/6　　先手負　 1/6　　　※後手に 6/6 勝ち点加算、先手 ０  勝ち点加算。1.0点先取性なら２番で終わり。対局者Ａの１点勝ち
..................................
３　　先手勝　16/6　　後手負　 2/6　　　※2.0点先取性なら３番で終わり。対局者Ａの２点勝ち（後手勝ちがあると前後は先手番なので３連勝しやすい）
..................................
４　　後手負　17/6　　先手勝　 7/6
５　　先手勝　22/6　　後手負　 8/6　　　※3.0点先取性なら５番で終わり。対局者Ａの３点勝ち
..................................
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　番勝負の最初に先手を持った方が、  
後手番で１つ勝ったところで、ベースケースより早く終わることは無さそうだな」  

### 例６：　対局者Ｂが１つ後手勝ちするケース（サドンデス）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手負　 0/6　　後手勝　 6/6　　　※先手に 0/6 勝ち点、後手に 6/6 勝ち点。1.0点先取性なら１番で終わり。対局者Ｂの１点勝ち
..................................
２　　後手負　 1/6　　先手勝　11/6　　　※2.0点先取性なら３番で終わり。対局者Ｂのみなし２点勝ち。このあと対局者Ａが先手で勝っても、対局者Ｂに点数が入ってくるから　　
..................................
３　　先手勝　 6/6　　後手負　12/6
４　　後手負　 7/6　　先手勝　17/6　　　※3.0点先取性なら４番で終わり。対局者Ｂのみなし３点勝ち。このあと対局者Ａが先手で勝っても、対局者Ｂに点数が入ってくるから　　
..................................
×　　先手勝　12/6　　後手負　18/6　　　※この対局を行わなくても、対局者Ｂの勝ちが決まっているので、この対局は行われない
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　最初に後手を持った方が　番勝負の最初に１つ勝つと、  
相手がすぐに後手番で取り返さなければ、  
その差がずっと利いていて、ベースケースより早く終わることが有るようだな」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　クソ・ルールだろ」  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
「　**最初に後手番を持った方がいきなり勝つ** という事象には、 **確率的には** 、優遇がかかるのよ」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　確率的って何なんだぜ？  
対局に負けたタイミングで番勝負に勝つことはない、みたいなルールにしたら　どうだぜ？」  

### 例７：　（参考記録）対局に負けたタイミングで番勝負に勝つことはないルールにしたら？

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手負　 0/6　　後手勝　 6/6　　　※先手に 0/6 勝ち点、後手に 6/6 勝ち点。1.0点先取性なら１番で終わり。対局者Ｂの１点勝ち
..................................
２　　後手負　 1/6　　先手勝　11/6
３　　先手勝　 6/6　　後手負　12/6　　　※（修正ルール）後手にも勝ち点が入ってくるが、対局に負けたタイミングで番勝負に勝つことはない
４　　後手負　 7/6　　先手勝　17/6　　　※2.0点先取性なら４番で終わり。対局者Ｂの２点勝ち
..................................
５　　先手勝　12/6　　後手負　18/6　　　※（修正ルール）後手にも勝ち点が入ってくるが、対局に負けたタイミングで番勝負に勝つことはない
６　　後手負　13/6　　先手勝　22/6　　　※3.0点先取性なら６番で終わり。対局者Ｂの３点勝ち
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　対局者Ｂは、結局、４つ勝つ必要があり、  
後手番で１つ勝ったという事象に対して、メリットがないことになるな」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　そうなのか～。  
じゃあ　番勝負の１局目の勝敗は　すごい重要になるな？」  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
「　**先手有利** を消すには、それぐらいの強い調整が必要になるのよ」  

### 例８：　（参考記録）対局者Ｂが１つ後手勝ちしたあと、対局者Ａがすぐに後手で勝つケース

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手負　 0/6　　後手勝　 6/6　　　※1.0点先取性なら１番で終わり。対局者Ｂの１点勝ち
..................................
２　　後手勝　 6/6　　先手負　6/6　　　※振り出しに戻った
３　　先手勝　11/6　　後手負　7/6　　　※続けて先手番が取れるので、後手番で勝つと、そのあとずっとメリットを取れる
４　　後手負　 12/6　　先手勝　12/6
５　　先手勝　17/6　　後手負　13/6　　　※2.0点先取性なら５番で終わり。対局者Ａの２点勝ち
..................................
６　　後手負　 18/6　　先手勝　18/6
７　　先手勝　23/6　　後手負　19/6　　　※3.0点先取性なら７番で終わり。対局者Ａの３点勝ち
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　後手で勝つと、そのあと続けて先手番がやってくるので、ずっと有利になる。  
その有利なときに　負けると、有利は相手に行く。  
なんにしろ　最後に後手番で勝った方には　**ずっと大げさなアドバンテージ**　がもらえる。  
最後に先手番で負けた方には　**ずっと大げさなディスアドバンテージ**　が付けられる」  

## 先手勝率７０％のケース

### 例９：　先手番だけが勝つケース（最長のケース）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手勝　 5/7　　後手負　 2/7　　　※先手に 5/7 勝ち点、後手 2/7 勝ち点
２　　後手負　 7/7　　先手勝　 7/7
３　　先手勝　12/7　　後手負　 9/7　　　※1.0点先取性なら３番で終わり。対局者Ａの１点勝ち
..................................
４　　後手負　14/7　　先手勝　14/7
５　　先手勝　16/7　　後手負　19/7　　　※2.0点先取性なら５番で終わり。対局者Ａの２点勝ち
..................................
６　　後手負　21/7　　先手勝　21/7　　　※勝ち点が同じなので、もう１対局行う
７　　先手勝　26/7　　後手負　23/7　　　※3.0点先取性なら７番で終わり。対局者Ａの３点勝ち
..................................
```

### 例９：　後手番だけが勝つケース（最短のケース）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手負　 0/7　　後手勝　 7/7　　　※先手に ０ 勝ち点、後手 7/7 勝ち点。1.0点先取性なら１番で終わり。対局者Ｂの１点勝ち
..................................
２　　後手勝　 7/7　　先手負　 7/7
３　　先手負　 7/7　　後手勝　14/7　　　※2.0点先取性なら３番で終わり。対局者Ｂの２点勝ち
..................................
４　　後手勝　14/7　　先手負　14/7
５　　先手負　14/7　　後手勝　21/7　　　※3.0点先取性なら５番で終わり。対局者Ｂの３点勝ち
..................................
```

### 例１０：　対局者Ａが１つ後手勝ちするケース

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手勝　 5/7　　後手負　 2/7
２　　後手勝　12/7　　先手負　 2/7　　　※後手に 7/7 勝ち点、先手 ０  勝ち点。1.0点先取性なら２番で終わり。対局者Ａの１点勝ち
..................................
３　　先手勝　17/7　　後手負　 4/7　　　※2.0点先取性なら３番で終わり。対局者Ａの２点勝ち
..................................
４　　後手負　19/7　　先手勝　 9/7
５　　先手勝　21/7　　後手負　11/7　　　※3.0点先取性なら５番で終わり。対局者Ａの３点勝ち
..................................
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　後手で１つ勝つことは、先手で１つ勝つことより　ちゃんと　メリットがあるな」  

### 例１１：　対局者Ｂが１つ後手勝ちするケース

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手負　 0/7　　後手勝　 7/7　　　※後手に 7/7 勝ち点、先手 ０  勝ち点。1.0点先取性なら１番で終わり。対局者Ｂの１点勝ち
..................................
２　　後手負　 9/7　　先手勝　12/7
３　　先手勝　14/7　　後手負　14/7
４　　後手負　16/7　　先手勝　19/7　　　※2.0点先取性なら４番で終わり。対局者Ｂの２点勝ち
..................................
５　　先手勝　21/7　　後手負　21/7
６　　後手負　23/7　　先手勝　26/7　　　※3.0点先取性なら６番で終わり。対局者Ｂの３点勝ち
..................................
```

# きふわらべには、きふわらべ式は要らない

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　先手勝率７０％ではない　わたしには　きふわらべ式は　要らんなあ」  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　先手勝率５０％　～　先手勝率７０％　の将棋エンジンが　混合できる計算式は  
まだ思案中だぜ」  

.