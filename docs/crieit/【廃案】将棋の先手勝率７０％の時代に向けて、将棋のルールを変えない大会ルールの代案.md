# 前の関連記事

📖　[【将棋】千日手は後手何勝分か（＾～＾）？](https://crieit.net/posts/35bb78372fdb17061111e859632f839f)  

# はじめに

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　スレッド違いということで　提出直後に廃案になった、  
**先手勝率が７０％になったゲームで　先手の有利さを解消する案**　の残骸を　置いておくぜ」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　お父んは　国語ができないからな」  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
「　この誰も読んでないブログを使って　Crieit のダラ管理人のサーバー代で　記事を保管しましょう」  

## 欠点

* 弱い将棋エンジンが後手持つと有利になってしまう

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　わらう」  

## きふわらべ式の概要

* **１局の勝利の期待値を 0.5 に調整する**

![202312__shogi__01-1924--KomiDashi.png](https://crieit.now.sh/upload_images/113ff0446f420ea8846acfec02f119af656df18f0d08f.png)  

```plaintext
先手勝率を x とする。
　　　　
先手が勝ったときの
　　　　先手の勝ち星は　ｙ、
　　　　後手の勝ち星は　１－ｙ
とする。
　　　　
後手が勝ったときの
　　　　先手の勝ち星は　０、
　　　　後手の勝ち星は　１
とする。
　　　　
　　　　 １
ｙ　＝　────　
　　　　２ｘ
```

### 計算例

```plaintext
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ０
先手勝率　５０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ５


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 １
先手勝率　６０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　６　　　　　　　　　　 ６


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ２
先手勝率　７０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　７　　　　　　　　　　 ７


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ３
先手勝率　８０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　８　　　　　　　　　　 ８


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ４
先手勝率　９０％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　９　　　　　　　　　　 ９


　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　５　　　　　　　　　　 ５
先手勝率１００％の場合、　先手が勝った時には、先手に勝ち点　─────　、後手に勝ち点　─────　を与える
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　 １０　　　　　　　　　 １０
```

* 先手と後手の有利さが　５０％ vs ５０％　の場合、先手が勝つと　先手の１勝ち点、後手の０勝ち点となり　従来通りとなる
* もし将棋が強解決して、先手勝率が１００％だった場合、先手が勝つと　先手０．５勝ち点、後手０．５勝ち点　となり、勝負無しと同じことになる

### 数式の説明

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　小学６年生で習う、 **反比例** で　できている。  
`x` は、 `x` が大きくなるほど大きくなる **比例** だが、  
`1/x` は、 `x` が大きくなるほど数字が小さくなる **反比例** だな」  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　まず、将棋が強解決して、先手勝率１００％　になったとき、先手に 0.5 点しか入らないように調整する。  
先手勝率１００％　というのは　実数で書くと `1.0` だな。  
0.5 というのは分数で書くと `1/2` だな」  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　次に、将棋が　先手も　後手も　勝率が　５０％、５０％　のケースを想定する。  
この場合、先手が勝ったら　１勝　が入って欲しい。  
１勝というのは　実数で書くと `1.0` だな。  
1.0 というのは分数で書くと `1/1` だな。  
じゃあ、 `1/2` を `1/1` に調整するには、分母に `0.5` を掛ければいいな。  
`1/(2 * 0.5)`」  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　じゃあ `0.5` を　試しに `x` に置き換えてみようぜ？  
`1/(2 * x)`」  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
「　先手勝率　７０％　なら `1/(2 * 0.7)`　で　いけてるな」  

# 筆算でシミュレーションしてみよう

ベースケース（**従来の番勝負の例**）：  

* 先手、後手の勝率は　５０％　vs　５０％　だろうと想定されている
* 先後を互いに交代する
* ５番勝負は　先に３勝した方の勝ち
* ７番勝負は　先に４勝した方の勝ち

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　ベースケースというのは、従来の方法という意味だぜ。  
きふわらべ式が、先手勝率　５０％　のとき、ベースケースと同じになるか　筆算して確認してみよう」  

## 先手勝率５０％のケース（ベースケース）

### 例１：　先手番だけが勝つケース（最長のケース）

```plaintext
番　　対局者A 　　　　対局者B 
ー　　ーーーーーー　　ーーーーーー
１　　先手勝　 5/5　　後手負　 0/5　　　※先手に 5/5 勝ち点、後手 0/5 勝ち点。 1.0点先取性なら１番で終わり。先手の勝ち
..................................
２　　後手負　 5/5　　先手勝　 5/5　　　※先手に 0/5 勝ち点加算、後手 5/5 勝ち点加算。
３　　先手勝　10/5　　後手負　 5/5　　　※2.0点先取性なら３番で終わり。対局者Ａの１点勝ち
..................................
４　　後手負　10/5　　先手勝　10/5
５　　先手勝　15/5　　後手負　10/5　　　※2.0点先取性なら５番で終わり。対局者Ａの２点勝ち
..................................
６　　後手負　15/5　　先手勝　15/5
７　　先手勝　20/5　　後手負　15/5　　　※3.0点先取性なら７番で終わり。対局者Ａの３点勝ち
..................................
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　👆　ベースケースと同じになりそうだな」  

## 先手勝率６０％のケース

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
「　じゃあ　先手勝率６０％　の特殊なケースを　シミュレーションしてみようぜ？」  

.